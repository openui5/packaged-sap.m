<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<title>Test Page for sap.m.P13nColumnsPanel</title>
<script id="sap-ui-bootstrap" data-sap-ui-theme="sap_bluecrystal"
	type="text/javascript" data-sap-ui-noConflict="true"
	data-sap-ui-libs="sap.m" src="../../../../resources/sap-ui-core.js">
	
</script>

<link rel="stylesheet"
	href="../../../../resources/sap/ui/thirdparty/qunit.css"
	type="text/css" media="screen" />
<script type="text/javascript"
	src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
<script type="text/javascript"
	src="../../../../resources/sap/ui/qunit/qunit-junit.js"></script>
<script type="text/javascript"
	src="../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
<script type="text/javascript"
	src="../../../../resources/sap/ui/thirdparty/sinon.js"></script>
<script type="text/javascript"
	src="../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>

<script type="text/javascript">
	(function() {
		jQuery.sap.require("sap.m.P13nColumnsPanel");
		jQuery.sap.require("sap.m.ColumnListItem");
		jQuery.sap.require("sap.m.P13nItem");
		var oP13nColumnsPanel = null;

		module("Properties", {
			setup : function() {
				oP13nColumnsPanel = new sap.m.P13nColumnsPanel({});
			},
			teardown : function() {
				/* 			oP13nColumnsPanel.destroy();
				 oP13nColumnsPanel = null; */
			}
		});

		test("Shall be instantiable to check conrol existence", function() {
			ok(oP13nColumnsPanel, "Could not instantiate P13nColumnsPanel");
		});

		test("Shall check _ItemMoveToTop", function() {
			ok(oP13nColumnsPanel._ItemMoveToTop, "Method does not exist");

			var getArrayIndexByItemKeySpy = sinon.stub();
			var handleItemIndexChangedSpy = sinon.stub();
			var changeColumnsItemsIndexesSpy = sinon.stub();
			var afterMoveItemSpy = sinon.stub();
			oP13nColumnsPanel._getArrayIndexByItemKey = getArrayIndexByItemKeySpy;
			oP13nColumnsPanel._handleItemIndexChanged = handleItemIndexChangedSpy;
			oP13nColumnsPanel._changeColumnsItemsIndexes = changeColumnsItemsIndexesSpy;
			oP13nColumnsPanel._afterMoveItem = afterMoveItemSpy;
			oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([{}, {}, {}, {}, {}, {}]);

			//CUT -> check that the method is not executed as this._oSelectedItem is empty
			oP13nColumnsPanel._oSelectedItem = null;
			oP13nColumnsPanel._ItemMoveToTop();
			strictEqual(getArrayIndexByItemKeySpy.callCount, 0, 'Method was executed although it should not be done');

			//CUT -> check that the method is executed, BUT item will not be moved as minimum boundary is reached
			getArrayIndexByItemKeySpy.returns(0);
			oP13nColumnsPanel._oSelectedItem = new sap.m.ColumnListItem();
			oP13nColumnsPanel._oSelectedItem.data('P13nColumnKey', '4711');
			oP13nColumnsPanel._ItemMoveToTop();
			strictEqual(handleItemIndexChangedSpy.notCalled, true,
					"Boundary check did fail -> general moveItem method shall not be executed");

			//CUT -> check that the method _is executed with old and new Indexes
			getArrayIndexByItemKeySpy.returns(5);
			oP13nColumnsPanel._oSelectedItem = new sap.m.ColumnListItem();
			oP13nColumnsPanel._oSelectedItem.data('P13nColumnKey', '4711');
			oP13nColumnsPanel._ItemMoveToTop();
			strictEqual(handleItemIndexChangedSpy.calledWith(oP13nColumnsPanel._oSelectedItem, 0), true,
					"Item move was done with wrong parameter");
			strictEqual(changeColumnsItemsIndexesSpy.called, true,
					"Method: _changeColumnsItemsIndexes was not called, although it should not be done");
			strictEqual(afterMoveItemSpy.called, true,
					"Method: _afterMoveItem was not called, although it should not be done");
		});

		test("Shall check _ItemMoveUp", function() {
			ok(oP13nColumnsPanel._ItemMoveUp, "Method does not exist");

			var getArrayIndexByItemKeySpy = sinon.stub();
			var handleItemIndexChangedSpy = sinon.stub();
			var changeColumnsItemsIndexesSpy = sinon.stub();
			var afterMoveItemSpy = sinon.stub();
			oP13nColumnsPanel._getArrayIndexByItemKey = getArrayIndexByItemKeySpy;
			oP13nColumnsPanel._handleItemIndexChanged = handleItemIndexChangedSpy;
			oP13nColumnsPanel._changeColumnsItemsIndexes = changeColumnsItemsIndexesSpy;
			oP13nColumnsPanel._afterMoveItem = afterMoveItemSpy;
			oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([{}, {}, {}, {}, {}, {}]);

			//CUT -> check that the method is not executed as this._oSelectedItem is empty
			oP13nColumnsPanel._oSelectedItem = null;
			oP13nColumnsPanel._ItemMoveUp();

			strictEqual(getArrayIndexByItemKeySpy.callCount, 0, 'Method was executed although it should not be done');

			//CUT -> check that the method is executed, BUT item will not be moved as minimum boundary is reached
			getArrayIndexByItemKeySpy.returns(0);
			oP13nColumnsPanel._oSelectedItem = new sap.m.ColumnListItem();
			oP13nColumnsPanel._oSelectedItem.data('P13nColumnKey', '4711');
			oP13nColumnsPanel._ItemMoveUp();

			strictEqual(handleItemIndexChangedSpy.notCalled, true,
					"Boundary check did fail -> general moveItem method shall not be executed");

			//CUT -> check that the method is executed with old and new Indexes
			getArrayIndexByItemKeySpy.returns(5);
			oP13nColumnsPanel._oSelectedItem = new sap.m.ColumnListItem();
			oP13nColumnsPanel._oSelectedItem.data('P13nColumnKey', '4711');
			oP13nColumnsPanel._ItemMoveUp();

			strictEqual(handleItemIndexChangedSpy.calledWith(oP13nColumnsPanel._oSelectedItem, 4), true,
					"Item move was done with wrong parameter");

			//CUT -> "Show Selected" is active -> now check that the method is executed with old and new index, where the new index was filled by method: _getPreviousSelectedItemIndex
			getArrayIndexByItemKeySpy.returns(5);
			oP13nColumnsPanel._oSelectedItem = new sap.m.ColumnListItem();
			oP13nColumnsPanel._oSelectedItem.data('P13nColumnKey', '4711');

			var getPreviousSelectedItemIndexSpy = sinon.stub();
			getPreviousSelectedItemIndexSpy.returns(3);
			oP13nColumnsPanel._bShowSelected = true;
			oP13nColumnsPanel._getPreviousSelectedItemIndex = getPreviousSelectedItemIndexSpy;

			oP13nColumnsPanel._ItemMoveUp();

			strictEqual(getPreviousSelectedItemIndexSpy.called, true,
					"Method: getPreviousSelectedItemIndex shall not be called to get the previous selected item");
			strictEqual(handleItemIndexChangedSpy.calledWith(oP13nColumnsPanel._oSelectedItem, 3), true,
					"Item move was done with wrong parameter");
			strictEqual(changeColumnsItemsIndexesSpy.called, true,
					"Method: _changeColumnsItemsIndexes was not called, although it should not be done");
			strictEqual(afterMoveItemSpy.called, true,
					"Method: _afterMoveItem was not called, although it should not be done");
		});

		test("Shall check _ItemMoveDown", function() {
			ok(oP13nColumnsPanel._ItemMoveDown, "Method does not exist");

			var getArrayIndexByItemKeySpy = sinon.stub();
			var handleItemIndexChangedSpy = sinon.stub();
			var changeColumnsItemsIndexesSpy = sinon.stub();
			var afterMoveItemSpy = sinon.stub();
			oP13nColumnsPanel._getArrayIndexByItemKey = getArrayIndexByItemKeySpy;
			oP13nColumnsPanel._handleItemIndexChanged = handleItemIndexChangedSpy;
			oP13nColumnsPanel._changeColumnsItemsIndexes = changeColumnsItemsIndexesSpy;
			oP13nColumnsPanel._afterMoveItem = afterMoveItemSpy;
			oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([{}, {}, {}, {}, {}, {}]);

			//CUT -> check that the method is not executed as this._oSelectedItem is empty
			oP13nColumnsPanel._oSelectedItem = null;
			oP13nColumnsPanel._ItemMoveDown();

			strictEqual(getArrayIndexByItemKeySpy.callCount, 0, 'Method was executed although it should not be done');

			//CUT -> check that the method is executed, BUT item will not be moved as maximum boundary is reached
			getArrayIndexByItemKeySpy.returns(5);
			oP13nColumnsPanel._oSelectedItem = new sap.m.ColumnListItem();
			oP13nColumnsPanel._oSelectedItem.data('P13nColumnKey', '4711');
			oP13nColumnsPanel._ItemMoveDown();

			strictEqual(handleItemIndexChangedSpy.notCalled, true,
					"Boundary check did fail -> general moveItem method shall not be executed");

			//CUT -> check that the method _is executed with old and new Indexes
			getArrayIndexByItemKeySpy.returns(4);
			oP13nColumnsPanel._oSelectedItem = new sap.m.ColumnListItem();
			oP13nColumnsPanel._oSelectedItem.data('P13nColumnKey', '4711');
			oP13nColumnsPanel._ItemMoveDown();

			strictEqual(handleItemIndexChangedSpy.calledWith(oP13nColumnsPanel._oSelectedItem, 5), true,
					"Item move was done with wrong parameter");

			//CUT -> "Show Selected" is active -> now check that the method is executed with old and new index, whereas the new index was filled by method: _getNextSelectedItemIndex
			getArrayIndexByItemKeySpy.returns(2);
			oP13nColumnsPanel._oSelectedItem = new sap.m.ColumnListItem();
			oP13nColumnsPanel._oSelectedItem.data('P13nColumnKey', '4711');

			var getNextSelectedItemIndexSpy = sinon.stub();
			getNextSelectedItemIndexSpy.returns(4);
			oP13nColumnsPanel._bShowSelected = true;
			oP13nColumnsPanel._getNextSelectedItemIndex = getNextSelectedItemIndexSpy;
			handleItemIndexChangedSpy.reset();
			oP13nColumnsPanel._ItemMoveDown();

			strictEqual(getNextSelectedItemIndexSpy.called, true,
					"Method: getNextSelectedItemIndex shall not be called to get the previous selected item");
			strictEqual(handleItemIndexChangedSpy.calledWith(oP13nColumnsPanel._oSelectedItem, 4), true,
					"Item move was done with wrong parameter");
			strictEqual(changeColumnsItemsIndexesSpy.called, true,
					"Method: _changeColumnsItemsIndexes was not called, although it should not be done");
			strictEqual(afterMoveItemSpy.called, true,
					"Method: _afterMoveItem was not called, although it should not be done");
		});

		test("Shall check _ItemMoveToBottom", function() {
			ok(oP13nColumnsPanel._ItemMoveToBottom, "Method does not exist");

			var getArrayIndexByItemKeySpy = sinon.stub();
			var handleItemIndexChangedSpy = sinon.stub();
			var changeColumnsItemsIndexesSpy = sinon.stub();
			var afterMoveItemSpy = sinon.stub();
			oP13nColumnsPanel._getArrayIndexByItemKey = getArrayIndexByItemKeySpy;
			oP13nColumnsPanel._handleItemIndexChanged = handleItemIndexChangedSpy;
			oP13nColumnsPanel._changeColumnsItemsIndexes = changeColumnsItemsIndexesSpy;
			oP13nColumnsPanel._afterMoveItem = afterMoveItemSpy;

			//CUT -> check that the method is not executed as this._oSelectedItem is empty
			oP13nColumnsPanel._oSelectedItem = null;
			oP13nColumnsPanel._ItemMoveToBottom();

			strictEqual(getArrayIndexByItemKeySpy.callCount, 0, 'Method was executed although it should not be done');

			//CUT -> check that the method is executed, BUT item will not be moved as maximum boundary is reached
			var oTableItem1 = new sap.m.ColumnListItem();
			oTableItem1.data('P13nColumnKey', '4711');
			var oTableItem2 = new sap.m.ColumnListItem();
			oTableItem2.data('P13nColumnKey', '4712');
			oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([oTableItem2, oTableItem1]);

			getArrayIndexByItemKeySpy.returns(1);
			oP13nColumnsPanel._oSelectedItem = new sap.m.ColumnListItem();
			oP13nColumnsPanel._oSelectedItem.data('P13nColumnKey', '4711');
			oP13nColumnsPanel._ItemMoveToBottom();

			strictEqual(handleItemIndexChangedSpy.notCalled, true,
					"Boundary check did fail -> general moveItem method shall not be executed");

			//CUT -> check that the method _is executed with old and new Indexes
			var oTableItem1 = new sap.m.ColumnListItem();
			oTableItem1.data('P13nColumnKey', '4711');
			var oTableItem2 = new sap.m.ColumnListItem();
			oTableItem2.data('P13nColumnKey', '4712');
			var oTableItem3 = new sap.m.ColumnListItem();
			oTableItem3.data('P13nColumnKey', '4713');
			var oTableItem4 = new sap.m.ColumnListItem();
			oTableItem4.data('P13nColumnKey', '4714');
			var oTableItem5 = new sap.m.ColumnListItem();
			oTableItem5.data('P13nColumnKey', '4715');
			oP13nColumnsPanel._oTable.getItems = sinon.stub().returns(
					[oTableItem1, oTableItem2, oTableItem3, oTableItem4, oTableItem5]);

			getArrayIndexByItemKeySpy.returns(1);
			oP13nColumnsPanel._oSelectedItem = new sap.m.ColumnListItem();
			oP13nColumnsPanel._oSelectedItem.data('P13nColumnKey', '4712');
			oP13nColumnsPanel._ItemMoveToBottom();

			strictEqual(handleItemIndexChangedSpy.calledWith(oP13nColumnsPanel._oSelectedItem, 4), true,
					"Item move was done with wrong parameter");
			strictEqual(changeColumnsItemsIndexesSpy.called, true,
					"Method: _changeColumnsItemsIndexes was not called, although it should be done");
			strictEqual(afterMoveItemSpy.called, true,
					"Method: _afterMoveItem was not called, although it should not be done");
		});

		test(
				"Shall check _changeColumnsItemsIndexes",
				function() {
					ok(oP13nColumnsPanel._changeColumnsItemsIndexes, "Method does not exist");

					var getColumnsItemsSpy = sinon.stub();
					oP13nColumnsPanel.getColumnsItems = getColumnsItemsSpy;
					getColumnsItemsSpy.returns([{
						"getColumnKey" : sinon.stub().returns("4711"),
						"getIndex" : sinon.stub().returns(1),
						"setIndex" : sinon.stub()
					}, {
						"getColumnKey" : sinon.stub().returns("4712"),
						"getIndex" : sinon.stub().returns(2),
						"setIndex" : sinon.stub()
					}]);
					oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([{}, {}, {}]);

					//CUT -> check that the method is not executed as no parameter are passed in
					oP13nColumnsPanel._changeColumnsItemsIndexes();
					strictEqual(oP13nColumnsPanel.getColumnsItems.notCalled, true,
							"Method: getColumnsItems was called, although it should not be done because of missing input parameter");

					//CUT -> check that the method is executed AND the index of first columnsItem has been changed to 0
					oP13nColumnsPanel._oSelectedItem = new sap.m.ColumnListItem();
					oP13nColumnsPanel._oSelectedItem.data('P13nColumnKey', '4712');
					oP13nColumnsPanel._changeColumnsItemsIndexes(1, 2);

					strictEqual(oP13nColumnsPanel.getColumnsItems.called, true,
							"Method: getColumnsItems was not called, although it should not be done");
					strictEqual(oP13nColumnsPanel.getColumnsItems()[0].getColumnKey.called, true,
							"Method: getColumnKey of first columnsItem was not called, although it should be done");
					strictEqual(oP13nColumnsPanel.getColumnsItems()[0].getIndex.called, true,
							"Method: getIndex of first columnsItem was not called, although it should be done");
					strictEqual(oP13nColumnsPanel.getColumnsItems()[0].setIndex.called, true,
							"Method: setIndex of first columnsItem was not called, although it should be done");
					strictEqual(oP13nColumnsPanel.getColumnsItems()[0].setIndex.calledWith(0), true,
							"setIndex of first columnsItem has been called with wrong property value");

					// Second columnsItem with key = 4712 shall not be changed as this is the instance of oSelectedItem; that shall be 
					// excluded as this has already the right index value
					strictEqual(
							oP13nColumnsPanel.getColumnsItems()[1].getColumnKey.called,
							true,
							"Method: getColumnKey of second columnsItem was not called, although it should be done to identify the current columnsItem");
					strictEqual(oP13nColumnsPanel.getColumnsItems()[1].getIndex.notCalled, true,
							"Method: getIndex of first columnsItem was called, although it should not be done");
					strictEqual(oP13nColumnsPanel.getColumnsItems()[1].setIndex.notCalled, true,
							"Method: setIndex of first columnsItem was called, although it should not be done");

					//CUT -> check that the method is executed AND the index of first columnsItem has been changed to 0
					oP13nColumnsPanel.getColumnsItems()[0].setIndex.reset();
					oP13nColumnsPanel._changeColumnsItemsIndexes(2, 1);

					strictEqual(oP13nColumnsPanel.getColumnsItems()[0].setIndex.calledWith(2), true,
							"setIndex of first columnsItem has been called with wrong property value");
				});

		test("Shall check _swopShowSelectedButton", function() {
			ok(oP13nColumnsPanel._swopShowSelectedButton, "Method does not exist");
			var bShowSelected_Before = bShowSelected_After = oP13nColumnsPanel._bShowSelected;
			oP13nColumnsPanel._filterItems = sinon.stub();
			oP13nColumnsPanel._fnHandleResize = sinon.stub();

			//CUT		
			oP13nColumnsPanel._swopShowSelectedButton();
			bShowSelected_After = oP13nColumnsPanel._bShowSelected;

			notEqual(bShowSelected_Before, bShowSelected_After, "Button swop did not work");
			strictEqual(oP13nColumnsPanel._filterItems.called, true, "Method _filterItems wasn't called");
			strictEqual(oP13nColumnsPanel._fnHandleResize.called, true, "Method _fnHandleResize wasn't called");
		});

		test("Shall check _afterMoveItem", function() {
			ok(oP13nColumnsPanel._afterMoveItem, "Method does not exist");
			oP13nColumnsPanel._scrollToSelectedItem = sinon.stub();
			oP13nColumnsPanel._calculateMoveButtonAppearance = sinon.stub();

			//CUT		
			oP13nColumnsPanel._afterMoveItem();
			strictEqual(oP13nColumnsPanel._scrollToSelectedItem.called, true, "Method _scrollToSelectedItem wasn't called");
			strictEqual(oP13nColumnsPanel._calculateMoveButtonAppearance.called, true,
					"Method _calculateMoveButtonAppearance wasn't called");
		});

		test("Shall check _filterItems if no filters are activated", function() {
			ok(oP13nColumnsPanel._filterItems, "Method does not exist");
			var oItem = {
				"id" : "4711",
				"getId" : function() {
					return this.id;
				},
				"getCells" : function() {
					return [{
						"getText" : function() {
							return "TestText";
						}
					}];
				},
				"setVisible" : sinon.stub()
			};

			oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([oItem]);
			oP13nColumnsPanel._oTable.getSelectedItems = sinon.stub().returns([]);
			oP13nColumnsPanel._bShowSelected = false;
			oP13nColumnsPanel._bSearchFilterActive = false;

			//CUT
			oP13nColumnsPanel._filterItems();
			strictEqual(oItem.setVisible.called, true, "Wrong filter logic: The one existing item should be set to visible");
			strictEqual(oP13nColumnsPanel._oTable.getItems.called, true,
					"Wrong filter logic: The table should return at least one item");
			strictEqual(oP13nColumnsPanel._oTable.getSelectedItems.called, false,
					"Wrong filter logic: getSelectedItems should not be called at all");
		});

		test("Shall check _filterItems if Search field filters is activ", function() {
			var oItem = {
				"id" : "4711",
				"getId" : function() {
					return this.id;
				},
				"getCells" : function() {
					return [{
						"getText" : function() {
							return "TestText";
						}
					}];
				},
				"setVisible" : sinon.stub()
			};

			oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([oItem]);
			oP13nColumnsPanel._oTable.getSelectedItems = sinon.stub().returns([]);
			oP13nColumnsPanel._bShowSelected = false;
			oP13nColumnsPanel._bSearchFilterActive = true;

			oP13nColumnsPanel._oSearchField.setValue('Test')
			//CUT -> With a filter that fit's to the table item (item visibility shall be set to true)
			oP13nColumnsPanel._filterItems();
			strictEqual(oItem.setVisible.called, true, "Set visible method is not called at all");
			strictEqual(oItem.setVisible.calledWith(true), true, "Set visible method is called with wrong parameter");

			strictEqual(oP13nColumnsPanel._oTable.getItems.called, true, "getItems method was not called at all");
			strictEqual(oP13nColumnsPanel._oTable.getItems.callCount, 2, "getItems method shall have been called two times");

			oP13nColumnsPanel._oTable.getItems.reset();
			oP13nColumnsPanel._oSearchField.setValue('TestA')
			//CUT -> With a filter that does not fit to the table items (item visibility shall be set to false)
			oP13nColumnsPanel._filterItems();
			strictEqual(oItem.setVisible.called, true, "Set visible method is not called at all");
			strictEqual(oItem.setVisible.calledWith(false), true, "Set visible method is called with wrong parameter");

			strictEqual(oP13nColumnsPanel._oTable.getItems.called, true, "getItems method was not called at all");
			strictEqual(oP13nColumnsPanel._oTable.getItems.callCount, 2, "getItems method shall have been called two times");

			strictEqual(oP13nColumnsPanel._oTable.getSelectedItems.called, false, "getSelectedItems shall not be called");
		});

		test("Shall check _filterItems if \"ShowSelected\" filter is activ", function() {
			var oItem = {
				"id" : "4711",
				"getId" : function() {
					return this.id;
				},
				"getCells" : function() {
					return [{
						"getText" : function() {
							return "TestText";
						}
					}];
				},
				"setVisible" : sinon.stub()
			};

			oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([oItem]);
			oP13nColumnsPanel._oTable.getSelectedItems = sinon.stub().returns([oItem]);
			oP13nColumnsPanel._bShowSelected = true;
			oP13nColumnsPanel._bSearchFilterActive = false;

			//CUT (with one selected item = oItem)
			oP13nColumnsPanel._filterItems();
			strictEqual(oItem.setVisible.called, true, "Set visible method is not called at all");
			strictEqual(oItem.setVisible.calledWith(true), true, "Set visible method is called with wrong parameter");

			strictEqual(oP13nColumnsPanel._oTable.getItems.called, true, "getItems method was not called at all");
			strictEqual(oP13nColumnsPanel._oTable.getItems.callCount, 1, "getItems method shall have been called 1 time");
			strictEqual(oP13nColumnsPanel._oTable.getSelectedItems.called, true, "getSelectedItems shall have been called");

			//CUT (with no selected items)
			oP13nColumnsPanel._oTable.getItems.reset();
			oP13nColumnsPanel._oTable.getSelectedItems.returns([]);
			oP13nColumnsPanel._oTable.getSelectedItems.reset();

			oP13nColumnsPanel._filterItems();
			strictEqual(oItem.setVisible.called, true, "Set visible method is not called at all");
			strictEqual(oItem.setVisible.calledWith(false), true, "Set visible method is called with wrong parameter");

			strictEqual(oP13nColumnsPanel._oTable.getItems.called, true, "getItems method was not called at all");
			strictEqual(oP13nColumnsPanel._oTable.getItems.callCount, 1, "getItems method shall have been called 1 time");
			strictEqual(oP13nColumnsPanel._oTable.getSelectedItems.called, true, "getSelectedItems shall have been called");
			strictEqual(oP13nColumnsPanel._oTable.getSelectedItems.callCount, 1,
					"getSelectedItems method shall have been called 1 time");
		});

		test("Shall check _executeSearch",
				function() {
					ok(oP13nColumnsPanel._executeSearch, "Method does not exist");
					oP13nColumnsPanel._oSearchField.setValue('TestSearchFieldValue')
					oP13nColumnsPanel._deactivateSelectedItem = sinon.stub();
					oP13nColumnsPanel._filterItems = sinon.stub();

					//CUT
					oP13nColumnsPanel._executeSearch();
					strictEqual(oP13nColumnsPanel._bSearchFilterActive, true, "Search filter shall be actived");
					strictEqual(oP13nColumnsPanel._deactivateSelectedItem.called, true,
							"From user selected item shall be deselected");
					strictEqual(oP13nColumnsPanel._filterItems.called, true, "_filterItems method shall be called");

					//CUT (no content filled in Search field)
					oP13nColumnsPanel._oSearchField.setValue('');
					oP13nColumnsPanel._deactivateSelectedItem.reset();
					oP13nColumnsPanel._filterItems.reset()

					oP13nColumnsPanel._executeSearch();
					strictEqual(oP13nColumnsPanel._bSearchFilterActive, false, "Search filter shall be deactived");
					strictEqual(oP13nColumnsPanel._deactivateSelectedItem.called, false,
							"From user selected item shall NOT be deselected");
					strictEqual(oP13nColumnsPanel._filterItems.called, true, "_filterItems method shall be called");
					strictEqual(oP13nColumnsPanel._filterItems.callCount, 1, "_filterItems method shall only be called once");
				});

		test("Shall check _updateSelectAllDescription", function() {
			ok(oP13nColumnsPanel._updateSelectAllDescription, "Method does not exist");
			oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([{}, {}, {}, {}, {}, {}]);
			oP13nColumnsPanel._oTable.getSelectedItems = sinon.stub().returns([{}, {}, {}]);
			var sText = "Test text from ressource bundle";
			oP13nColumnsPanel._oRb.getText = sinon.stub().returns(sText);

			var oColumn = oP13nColumnsPanel._oTable.getColumns()[0];
			var oColumnHeader = oColumn.getHeader();
			oColumnHeader.setText = sinon.stub();

			//CUT
			oP13nColumnsPanel._updateSelectAllDescription();
			strictEqual(oColumnHeader.setText.called, true, "Column header text shall be called");
			strictEqual(oColumnHeader.setText.callCount, 1, "Setting of column header text shall only be called once");
			strictEqual(oColumnHeader.setText.args[0][0], sText, "Column header text shall not be empty");

		});

		test("Shall check _itemPressed", function() {
			ok(oP13nColumnsPanel._itemPressed, "Method does not exist");

			var oEvent = {}, oItem = {
				"id" : "tempItem"
			};
			oEvent.getParameter = sinon.stub().returns(oItem);
			oP13nColumnsPanel._removeHighLightingFromItem = sinon.stub();
			oP13nColumnsPanel._setHighLightingToItem = sinon.stub();
			oP13nColumnsPanel._calculateMoveButtonAppearance = sinon.stub();

			//CUT (no table item was selected up to here) 
			oP13nColumnsPanel._oSelectedItem = null;
			oP13nColumnsPanel._itemPressed(oEvent);

			strictEqual(oP13nColumnsPanel._removeHighLightingFromItem.called, false,
					"HighLighting does not need to be removed");
			strictEqual(oP13nColumnsPanel._oSelectedItem, oItem, "The selected table item is wrong");
			strictEqual(oP13nColumnsPanel._setHighLightingToItem.called, true, "The selected item shall be highlighted");
			strictEqual(oP13nColumnsPanel._setHighLightingToItem.calledWith(oItem), true,
					"Wrong item instance passed to highlighting method");
			strictEqual(oP13nColumnsPanel._calculateMoveButtonAppearance.called, true,
					"Move button appearance was not recalculated");

			//CUT (a table item is already selected up to here)
			var oItem2 = {
				"id" : "tempItem2"
			};
			oEvent.getParameter.returns(oItem2);
			oP13nColumnsPanel._oSelectedItem = oItem;
			oP13nColumnsPanel._removeHighLightingFromItem.reset();
			oP13nColumnsPanel._setHighLightingToItem.reset();
			oP13nColumnsPanel._calculateMoveButtonAppearance.reset();

			oP13nColumnsPanel._itemPressed(oEvent);

			strictEqual(oP13nColumnsPanel._removeHighLightingFromItem.called, true,
					"HighLighting needs to be removed from previous selected item");
			strictEqual(oP13nColumnsPanel._oSelectedItem, oItem2, "The selected table item is wrong");
			strictEqual(oP13nColumnsPanel._setHighLightingToItem.called, true, "The selected item shall be highlighted");
			strictEqual(oP13nColumnsPanel._setHighLightingToItem.calledWith(oItem2), true,
					"Wrong item instance passed to highlighting method");
			strictEqual(oP13nColumnsPanel._calculateMoveButtonAppearance.called, true,
					"Move button appearance was not recalculated");
			strictEqual(oP13nColumnsPanel._calculateMoveButtonAppearance.callCount, 1,
					"Calculation of move button appearance was called to often.");
		});

		test(
				"Shall check _calculateMoveButtonAppearance",
				function() {
					ok(oP13nColumnsPanel._calculateMoveButtonAppearance, "Method does not exist");

					//CUT (no table item was selected up to here) 
					oP13nColumnsPanel._oSelectedItem = null;
					oP13nColumnsPanel._calculateMoveButtonAppearance();

					strictEqual(oP13nColumnsPanel._oMoveToTopButton.getEnabled(), false,
							"To Top button shall be disabled if no item is selected");
					strictEqual(oP13nColumnsPanel._oMoveUpButton.getEnabled(), false,
							"Up button shall be disabled if no item is selected");
					strictEqual(oP13nColumnsPanel._oMoveDownButton.getEnabled(), false,
							"Down button shall be disabled if no item is selected");
					strictEqual(oP13nColumnsPanel._oMoveToBottomButton.getEnabled(), false,
							"To Bottom button shall be disabled if no item is selected");

					//CUT (selected table item is the first item in the list)
					var oItem = new sap.m.ColumnListItem({
						"id" : "tempItemAtTopIndex"
					});
					oItem.data('P13nColumnKey', '4711');
					oP13nColumnsPanel._oSelectedItem = oItem;

					oP13nColumnsPanel._getArrayIndexByItemKey = sinon.stub().returns(0);
					oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([{}, {}, {}, {}, {}, {}]);

					oP13nColumnsPanel._calculateMoveButtonAppearance();

					strictEqual(oP13nColumnsPanel._oMoveToTopButton.getEnabled(), false,
							"To Top button shall be disabled if first item is selected");
					strictEqual(oP13nColumnsPanel._oMoveUpButton.getEnabled(), false,
							"Up button shall be disabled if first item is selected");
					strictEqual(oP13nColumnsPanel._oMoveDownButton.getEnabled(), true,
							"Down button shall be enabled if the first item is selected");
					strictEqual(oP13nColumnsPanel._oMoveToBottomButton.getEnabled(), true,
							"To Bottom button shall be enabled if the first item is selected");

					//CUT (selected table item is the last item in the list)
					var oItem = new sap.m.ColumnListItem({
						"id" : "tempItemAtBottomIndex"
					});
					oItem.data('P13nColumnKey', '4711');
					oP13nColumnsPanel._oSelectedItem = oItem;
					oP13nColumnsPanel._getArrayIndexByItemKey = sinon.stub().returns(5);
					oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([{}, {}, {}, {}, {}, {}]);

					oP13nColumnsPanel._calculateMoveButtonAppearance();

					strictEqual(oP13nColumnsPanel._oMoveToTopButton.getEnabled(), true,
							"To Top button shall be enabled if last item is selected");
					strictEqual(oP13nColumnsPanel._oMoveUpButton.getEnabled(), true,
							"Up button shall be enabled if last item is selected");
					strictEqual(oP13nColumnsPanel._oMoveDownButton.getEnabled(), false,
							"Down button shall be disabled if the last item is selected");
					strictEqual(oP13nColumnsPanel._oMoveToBottomButton.getEnabled(), false,
							"To bottom button shall be disabled if the last item is selected");

					//CUT (selected table item is one in the middle)
					var oItem = new sap.m.ColumnListItem({
						"id" : "tempItemWithinTheMiddle1"
					});
					oItem.data('P13nColumnKey', '4711');
					oP13nColumnsPanel._oSelectedItem = oItem;
					oP13nColumnsPanel._getArrayIndexByItemKey = sinon.stub().returns(3);
					oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([{}, {}, {}, {}, {}, {}]);

					oP13nColumnsPanel._calculateMoveButtonAppearance();

					strictEqual(oP13nColumnsPanel._oMoveToTopButton.getEnabled(), true,
							"To Top button shall be enabled if any middle item is selected");
					strictEqual(oP13nColumnsPanel._oMoveUpButton.getEnabled(), true,
							"Up button shall be enabled if any middle item is selected");
					strictEqual(oP13nColumnsPanel._oMoveDownButton.getEnabled(), true,
							"Down button shall be enabled if any middle item is selected");
					strictEqual(oP13nColumnsPanel._oMoveToBottomButton.getEnabled(), true,
							"To Bottom button shall be enabled if any middle item is selected");

					//CUT (selected table item does return with an index that is higher as the max the table length)
					var oItem = new sap.m.ColumnListItem({
						"id" : "tempItemWithinTheMiddle2"
					});
					oItem.data('P13nColumnKey', '4711');
					oP13nColumnsPanel._oSelectedItem = oItem;
					oP13nColumnsPanel._getArrayIndexByItemKey = sinon.stub().returns(6);
					oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([{}, {}, {}, {}, {}, {}]);

					oP13nColumnsPanel._calculateMoveButtonAppearance();

					strictEqual(oP13nColumnsPanel._oMoveToTopButton.getEnabled(), false,
							"To Top button shall be disabled if the selected item does return an index that is out of the table boundaries");
					strictEqual(oP13nColumnsPanel._oMoveUpButton.getEnabled(), false,
							"Up button shall be disabled if the selected item does return an index that is out of the table boundaries");
					strictEqual(oP13nColumnsPanel._oMoveDownButton.getEnabled(), false,
							"Down button shall be disabled if the selected item does return an index that is out of the table boundaries");
					strictEqual(
							oP13nColumnsPanel._oMoveToBottomButton.getEnabled(),
							false,
							"To Bottom button shall shall be disabled if the selected item does return an index that is out of the table boundaries");

					//CUT (selected table item does return with an index that is lower the 0, which is the lowest table index)
					var oItem = new sap.m.ColumnListItem({
						"id" : "tempItemWithinTheMiddle3"
					});
					oItem.data('P13nColumnKey', '4711');
					oP13nColumnsPanel._oSelectedItem = oItem;
					oP13nColumnsPanel._getArrayIndexByItemKey = sinon.stub().returns(-1);
					oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([{}, {}, {}, {}, {}, {}]);

					oP13nColumnsPanel._calculateMoveButtonAppearance();

					strictEqual(oP13nColumnsPanel._oMoveToTopButton.getEnabled(), false,
							"To Top button shall be disabled if the selected item does return an index that is out of the table boundaries");
					strictEqual(oP13nColumnsPanel._oMoveUpButton.getEnabled(), false,
							"Up button shall be disabled if the selected item does return an index that is out of the table boundaries");
					strictEqual(oP13nColumnsPanel._oMoveDownButton.getEnabled(), false,
							"Down button shall be disabled if the selected item does return an index that is out of the table boundaries");
					strictEqual(
							oP13nColumnsPanel._oMoveToBottomButton.getEnabled(),
							false,
							"To Bottom button shall shall be disabled if the selected item does return an index that is out of the table boundaries");
				});

		test("Shall check _setHighLightingToItem", function() {
			ok(oP13nColumnsPanel._setHighLightingToItem, "Method does not exist");

			var oItem = {};
			oItem.addStyleClass = sinon.stub();
			//CUT
			oP13nColumnsPanel._setHighLightingToItem(oItem);
			strictEqual(oItem.addStyleClass.called, true, "At given item a specific style class shall be set");
		});

		test("Shall check _removeHighLightingFromItem", function() {
			ok(oP13nColumnsPanel._removeHighLightingFromItem, "Method does not exist");

			var oItem = {};
			oItem.removeStyleClass = sinon.stub();
			//CUT
			oP13nColumnsPanel._removeHighLightingFromItem(oItem);
			strictEqual(oItem.removeStyleClass.called, true, "At given item the specific style class shall be removed");
		});

		test("Shall check _deactivateSelectedItem", function() {
			ok(oP13nColumnsPanel._deactivateSelectedItem, "Method does not exist");

			//CUT
			oP13nColumnsPanel._oSelectedItem = null;
			oP13nColumnsPanel._removeHighLightingFromItem = sinon.stub();
			oP13nColumnsPanel._calculateMoveButtonAppearance = sinon.stub();

			oP13nColumnsPanel._deactivateSelectedItem();
			strictEqual(oP13nColumnsPanel._removeHighLightingFromItem.called, false,
					"No item is selected & no highlighting needs to be removed");
			strictEqual(oP13nColumnsPanel._calculateMoveButtonAppearance.called, false,
					"No item is selected & no highlighting needs to be removed");

			//CUT
			var oItem = sinon.stub();
			oP13nColumnsPanel._oSelectedItem = oItem;
			oP13nColumnsPanel._removeHighLightingFromItem.reset();
			oP13nColumnsPanel._calculateMoveButtonAppearance.reset();

			oP13nColumnsPanel._deactivateSelectedItem();
			strictEqual(oP13nColumnsPanel._removeHighLightingFromItem.called, true,
					"An item is selected -> method to remove highlighting needs to be called");
			strictEqual(oP13nColumnsPanel._removeHighLightingFromItem.calledWith(oItem), true,
					"Method to remove item highlighting needs to be called for actual selected item");
			strictEqual(oP13nColumnsPanel._calculateMoveButtonAppearance.called, true,
					"Item selection was removed -> -> Recalculate move button appearance");
			strictEqual(oP13nColumnsPanel._calculateMoveButtonAppearance.callCount, 1,
					"Recalculate of move button appearance shall only be called once");
			strictEqual(oP13nColumnsPanel._oSelectedItem, null, "Instance of selected item shall be reset");
		});

		test("Shall check _getArrayIndexByItemKey", function() {
			ok(oP13nColumnsPanel._getArrayIndexByItemKey, "Method does not exist");

			var oItem = null
			var oTableItem1, oTableItem2, oTableItem3, oTableItem4, oTableItem5, oTableItem6;

			//CUT (no valid item is passed into the method)
			oItem = null, iItemIndex = null;
			iItemIndex = oP13nColumnsPanel._getArrayIndexByItemKey("4711", []);
			strictEqual(iItemIndex, -1, "Wrong return value if no valid item is passed");

			//CUT (Valid item with key 4711 that exist in the list)
			oTableItem1 = new sap.m.ColumnListItem();
			oTableItem1.data('P13nColumnKey', '4711');
			oTableItem2 = new sap.m.ColumnListItem();
			oTableItem2.data('P13nColumnKey', '4712');
			oTableItem3 = new sap.m.ColumnListItem();
			oTableItem3.data('P13nColumnKey', '4713');
			oTableItem4 = new sap.m.ColumnListItem();
			oTableItem4.data('P13nColumnKey', '4714');
			oTableItem5 = new sap.m.ColumnListItem();
			oTableItem5.data('P13nColumnKey', '4715');
			oTableItem6 = new sap.m.ColumnListItem();
			oTableItem6.data('P13nColumnKey', '4716');

			var aTableItems = [oTableItem2, oTableItem3, oTableItem4, oTableItem1, oTableItem5, oTableItem6];
			iItemIndex = oP13nColumnsPanel._getArrayIndexByItemKey("4711", aTableItems);
			strictEqual(iItemIndex, 3, "Wrong index return for a valid item");

			//CUT (Valid item with key 4717 that does not exist in the list)
			oItem = new sap.m.P13nItem(), iItemIndex = null;
			oItem.data('P13nColumnKey', '4717');

			oTableItem1 = new sap.m.ColumnListItem();
			oTableItem1.data('P13nColumnKey', '4712');
			oTableItem2 = new sap.m.ColumnListItem();
			oTableItem2.data('P13nColumnKey', '4714');
			oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([oTableItem1, oTableItem2]);

			iItemIndex = oP13nColumnsPanel._getArrayIndexByItemKey(oItem);
			strictEqual(iItemIndex, -1, "Wrong index return -> item is valid but it shall not exist in that list of items");
		});

		test("Shall check onAfterRendering", function() {
			ok(oP13nColumnsPanel.onAfterRendering, "Method does not exist");

			oP13nColumnsPanel._calculateMoveButtonAppearance = sinon.stub();
			oP13nColumnsPanel._updateSelectAllDescription = sinon.stub();
			oP13nColumnsPanel._fnHandleResize = sinon.stub();

			var oInitialModel = {
				"id" : "initial model"
			};
			oP13nColumnsPanel._oTable.getModel = sinon.stub().returns({
				"getJSON" : function() {
					return {};
				}
			});
			oP13nColumnsPanel._oTable.getModel().getJSON = sinon.stub().returns(oInitialModel);
			sap.ui.Device.resize.attachHandler = sinon.stub();
			window.clearTimeout = sinon.stub();
			window.setTimeout = sinon.stub();

			// CUT (onAfterRendering will be called for the very first time)
			oP13nColumnsPanel._bOnAfterRenderingFirstTimeExecuted = false;
			oP13nColumnsPanel.onAfterRendering();

			strictEqual(oP13nColumnsPanel._bOnAfterRenderingFirstTimeExecuted, true,
					"Marker that onAfterRendering method was called shall be set to true");
			strictEqual(oP13nColumnsPanel._calculateMoveButtonAppearance.called, true,
					"Calculation of move button appearance shall be called");
			strictEqual(sap.ui.Device.resize.attachHandler.called, true, "Resize handler shall be attached");
			strictEqual(window.clearTimeout.called, true, "timer shall be cleared");
			strictEqual(window.setTimeout.called, true, "time shall be set to call method _fnHandleResize");
		});

		test("Shall check exit", function() {
			ok(oP13nColumnsPanel.exit, "Method does not exist");

			sap.ui.Device.resize.detachHandler = sinon.spy();

			var fMoveToTopButton = oP13nColumnsPanel._oMoveToTopButton.destroy;
			oP13nColumnsPanel._oMoveToTopButton.destroy = oMoveToTopButtonStub = sinon.stub();

			var fMoveUpButton = oP13nColumnsPanel._oMoveUpButton.destroy;
			oP13nColumnsPanel._oMoveUpButton.destroy = oMoveUpButtonStub = sinon.stub();

			var fMoveDownpButton = oP13nColumnsPanel._oMoveDownButton.destroy;
			oP13nColumnsPanel._oMoveDownButton.destroy = oMoveDownButtonStub = sinon.stub();

			var fMoveToBottomButton = oP13nColumnsPanel._oMoveToBottomButton.destroy;
			oP13nColumnsPanel._oMoveToBottomButton.destroy = oMoveToBottomButtonStub = sinon.stub();

			var fSearchField = oP13nColumnsPanel._oSearchField.destroy;
			oP13nColumnsPanel._oSearchField.destroy = oSearchFieldStub = sinon.stub();

			var fToolbar = oP13nColumnsPanel._oToolbar.destroy;
			oP13nColumnsPanel._oToolbar.destroy = oToolbarStub = sinon.stub();

			var fTable = oP13nColumnsPanel._oTable.destroy;
			oP13nColumnsPanel._oTable.destroy = oTableStub = sinon.stub();

			// CUT
			oP13nColumnsPanel.exit();

			strictEqual(sap.ui.Device.resize.detachHandler.called, true, "Detach of resize handler shall be called");
			strictEqual(oMoveToTopButtonStub.called, true, "Destroy of move to Top button shall be be called");
			strictEqual(oP13nColumnsPanel._oMoveToTopButton, null, "Move to Top button shall be set to null");
			strictEqual(oMoveUpButtonStub.called, true, "Destroy of move Up button shall be be called");
			strictEqual(oP13nColumnsPanel._oMoveUpButton, null, "Move Up button shall be set to null");
			strictEqual(oMoveDownButtonStub.called, true, "Destroy of move Down button shall be be called");
			strictEqual(oP13nColumnsPanel._oMoveDownButton, null, "Move Down button shall be set to null");
			strictEqual(oMoveToBottomButtonStub.called, true, "Destroy of move to Bottom button shall be be called");
			strictEqual(oP13nColumnsPanel._oMoveToBottomButton, null, "Move to Bottom button shall be set to null");
			strictEqual(oSearchFieldStub.called, true, "Destroy of search field shall be be called");
			strictEqual(oP13nColumnsPanel._oSearchField, null, "Serach field shall be set to null");
			strictEqual(oToolbarStub.called, true, "Destroy of toolbar shall be be called");
			strictEqual(oP13nColumnsPanel._oToolbar, null, "Toolbar shall be set to null");
			strictEqual(oTableStub.called, true, "Destroy of table shall be be called");
			strictEqual(oP13nColumnsPanel._oTable, null, "Table shall be set to null");
		});

		test("Shall check _scrollToSelectedItem", function() {
			ok(oP13nColumnsPanel._scrollToSelectedItem, "Method does not exist");

			var oItem = new sap.m.ColumnListItem();
			oItem.getDomRef = sinon.stub().returns({});
			oItem.focus = sinon.stub();
			document.activeElement.focus = sinon.stub();

			// CUT
			oP13nColumnsPanel._scrollToSelectedItem(oItem);
			strictEqual(oItem.getDomRef.called, true, "Method to get the Dom reference of given item was not called");
			strictEqual(oItem.focus.called, true, "Focus was not set to given item");
			strictEqual(document.activeElement.focus.called, true, "Focus was not reset to previous focused object");
		});

		test("Shall check _getPreviousSelectedItemIndex", function() {
			ok(oP13nColumnsPanel._getPreviousSelectedItemIndex, "Method does not exist");

			var oResultIndex = null;
			var oTableItem1 = new sap.m.ColumnListItem();
			oTableItem1.data('P13nColumnKey', '4711');
			oTableItem1.getSelected = sinon.stub().returns(true);
			var oTableItem2 = new sap.m.ColumnListItem();
			oTableItem2.data('P13nColumnKey', '4712');
			oTableItem2.getSelected = sinon.stub().returns(false);
			var oTableItem3 = new sap.m.ColumnListItem();
			oTableItem3.data('P13nColumnKey', '4712');
			oTableItem3.getSelected = sinon.stub().returns(true)
			oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([oTableItem1, oTableItem2, oTableItem3]);

			//CUT -> check that the method is NOT executed, as no start index is passed in
			oResultIndex = oP13nColumnsPanel._getPreviousSelectedItemIndex();
			strictEqual(oResultIndex, -1, "No valid index shall be found");
			strictEqual(oP13nColumnsPanel._oTable.getItems.called, false,
					"Method getItems from main table shall not be called");

			//CUT -> check that the method is executed
			oResultIndex = oP13nColumnsPanel._getPreviousSelectedItemIndex(2);
			strictEqual(oResultIndex, 0, "Wrong index was returned");
			strictEqual(oP13nColumnsPanel._oTable.getItems.called, true, "Method getItems from main table was not called");

			//CUT -> check that the method is executed, but no further valid index will be found (as no other selected items exist up to index 0)
			oP13nColumnsPanel._oTable.getItems.reset();
			oTableItem1.getSelected.returns(false);
			oResultIndex = oP13nColumnsPanel._getPreviousSelectedItemIndex(2);
			strictEqual(oResultIndex, -1, "Wrong index was returned");
			strictEqual(oP13nColumnsPanel._oTable.getItems.called, true, "Method getItems from main table was not called");
		});

		test("Shall check _getNextSelectedItemIndex", function() {
			ok(oP13nColumnsPanel._getNextSelectedItemIndex, "Method does not exist");

			var oResultIndex = null;
			var oTableItem1 = new sap.m.ColumnListItem();
			oTableItem1.data('P13nColumnKey', '4711');
			oTableItem1.getSelected = sinon.stub().returns(true);
			var oTableItem2 = new sap.m.ColumnListItem();
			oTableItem2.data('P13nColumnKey', '4712');
			oTableItem2.getSelected = sinon.stub().returns(false);
			var oTableItem3 = new sap.m.ColumnListItem();
			oTableItem3.data('P13nColumnKey', '4712');
			oTableItem3.getSelected = sinon.stub().returns(true)
			oP13nColumnsPanel._oTable.getItems = sinon.stub().returns([oTableItem1, oTableItem2, oTableItem3]);

			//CUT -> check that the method is NOT executed, as no start index is passed in
			oResultIndex = oP13nColumnsPanel._getNextSelectedItemIndex();
			strictEqual(oResultIndex, -1, "No valid index shall be found");
			strictEqual(oP13nColumnsPanel._oTable.getItems.called, false,
					"Method getItems from main table shall not be called");

			//CUT -> check that the method is executed
			oResultIndex = oP13nColumnsPanel._getNextSelectedItemIndex(0);
			strictEqual(oResultIndex, 2, "Wrong index was returned");
			strictEqual(oP13nColumnsPanel._oTable.getItems.called, true, "Method getItems from main table was not called");

			//CUT -> check that the method is executed, but no further valid index will be found (as no other selected items exist up to table end)
			oP13nColumnsPanel._oTable.getItems.reset();
			oTableItem3.getSelected.returns(false);
			oResultIndex = oP13nColumnsPanel._getNextSelectedItemIndex(0);
			strictEqual(oResultIndex, -1, "Wrong index was returned");
			strictEqual(oP13nColumnsPanel._oTable.getItems.called, true, "Method getItems from main table was not called");
		});

		test("Shall check _handleItemIndexChanged", function() {
			ok(oP13nColumnsPanel._handleItemIndexChanged, "Method does not exist");

			var oItem = new sap.m.ColumnListItem();

			oP13nColumnsPanel._createNewColumnsItem = sinon.stub();
			oP13nColumnsPanel._getArrayIndexByItemKey = sinon.stub();
			oP13nColumnsPanel._updateTableItems = sinon.stub();
			oP13nColumnsPanel.fireAddColumnsItem = sinon.stub();

			oP13nColumnsPanel.getColumnsItems = sinon.stub();
			oP13nColumnsPanel.getColumnsItems.returns([{
				"getColumnKey" : sinon.stub().returns("4711"),
				"getIndex" : sinon.stub().returns(1),
				"setIndex" : sinon.stub()
			}, {
				"getColumnKey" : sinon.stub().returns("4712"),
				"getIndex" : sinon.stub().returns(2),
				"setIndex" : sinon.stub()
			}]);

			//CUT -> check that the method is NOT executed, as needed input parameter are missing
			oP13nColumnsPanel._handleItemIndexChanged();
			strictEqual(oP13nColumnsPanel.getColumnsItems.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel._getArrayIndexByItemKey.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel._updateTableItems.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel._createNewColumnsItem.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel.fireAddColumnsItem.called, false, "Method shall not be executed");

			//CUT -> check that the method is executed -> columnsItem with this key does not exist -> create new one
			oItem.data('P13nColumnKey', '4713');
			oP13nColumnsPanel._getArrayIndexByItemKey.returns(-1);
			var oNewColumnsItem = sinon.stub();
			oNewColumnsItem.setIndex = sinon.stub();
			oP13nColumnsPanel._createNewColumnsItem.returns(oNewColumnsItem);

			oP13nColumnsPanel._handleItemIndexChanged(oItem, 3);

			strictEqual(oP13nColumnsPanel.getColumnsItems.called, true, "Method shall be executed");
			strictEqual(oP13nColumnsPanel._getArrayIndexByItemKey.called, true, "Method shall be executed");
			strictEqual(oP13nColumnsPanel._updateTableItems.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel._createNewColumnsItem.called, true, "Method shall be executed");
			strictEqual(oP13nColumnsPanel.fireAddColumnsItem.called, true, "Method shall be executed");
			strictEqual(oNewColumnsItem.setIndex.called, true, "Method shall be executed");

			//CUT -> check that the method is executed -> columnsItem with this key already exist -> just change the index property
			oP13nColumnsPanel.getColumnsItems.reset();
			oP13nColumnsPanel._getArrayIndexByItemKey.reset();
			oP13nColumnsPanel._updateTableItems.reset();
			oP13nColumnsPanel._createNewColumnsItem.reset();
			oP13nColumnsPanel.fireAddColumnsItem.reset();

			oItem.data('P13nColumnKey', '4712');
			oP13nColumnsPanel._getArrayIndexByItemKey.returns(1);

			oP13nColumnsPanel._handleItemIndexChanged(oItem, 0);

			strictEqual(oP13nColumnsPanel.getColumnsItems.called, true, "Method shall be executed");
			strictEqual(oP13nColumnsPanel._getArrayIndexByItemKey.called, true, "Method shall be executed");
			strictEqual(oP13nColumnsPanel._updateTableItems.called, true, "Method shall be executed");
			strictEqual(oP13nColumnsPanel._createNewColumnsItem.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel.fireAddColumnsItem.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel.getColumnsItems()[1].setIndex.called, true, "Method shall be executed");
		});

		test("Shall check _handleItemVisibilityChanged", function() {
			ok(oP13nColumnsPanel._handleItemVisibilityChanged, "Method does not exist");

			var oItem = new sap.m.ColumnListItem();
			oItem.getSelected = sinon.stub();
			
			oP13nColumnsPanel._createNewColumnsItem = sinon.stub();
			oP13nColumnsPanel._getArrayIndexByItemKey = sinon.stub();
			oP13nColumnsPanel._updateTableItems = sinon.stub();
			oP13nColumnsPanel.fireAddColumnsItem = sinon.stub();

			oP13nColumnsPanel.getColumnsItems = sinon.stub();
			oP13nColumnsPanel.getColumnsItems.returns([{
				"getColumnKey" : sinon.stub().returns("4711"),
				"getVisible" : sinon.stub().returns(true),
				"setVisible" : sinon.stub()
			}, {
				"getColumnKey" : sinon.stub().returns("4712"),
				"getVisible" : sinon.stub().returns(false),
				"setVisible" : sinon.stub()
			}]);

			//CUT -> check that the method is NOT executed, as needed input parameter is missing
			oP13nColumnsPanel._handleItemVisibilityChanged();
			strictEqual(oP13nColumnsPanel.getColumnsItems.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel._getArrayIndexByItemKey.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel._updateTableItems.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel._createNewColumnsItem.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel.fireAddColumnsItem.called, false, "Method shall not be executed");

			//CUT -> check that the method is executed -> columnsItem with this key does not exist -> create new one
			oItem.data('P13nColumnKey', '4713');
			oP13nColumnsPanel._getArrayIndexByItemKey.returns(-1);
			var oNewColumnsItem = sinon.stub();
			oNewColumnsItem.setVisible = sinon.stub();
			oP13nColumnsPanel._createNewColumnsItem.returns(oNewColumnsItem);

			oP13nColumnsPanel._handleItemVisibilityChanged(oItem);

			strictEqual(oP13nColumnsPanel.getColumnsItems.called, true, "Method shall be executed");
			strictEqual(oP13nColumnsPanel._getArrayIndexByItemKey.called, true, "Method shall be executed");
			strictEqual(oP13nColumnsPanel._updateTableItems.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel._createNewColumnsItem.called, true, "Method shall be executed");
			strictEqual(oP13nColumnsPanel.fireAddColumnsItem.called, true, "Method shall be executed");
			strictEqual(oNewColumnsItem.setVisible.called, true, "Method shall be executed");
			strictEqual(oItem.getSelected.called, true, "Method shall be executed");

			//CUT -> check that the method is executed -> columnsItem with this key already exist -> just change the visible property
			oP13nColumnsPanel.getColumnsItems.reset();
			oP13nColumnsPanel._getArrayIndexByItemKey.reset();
			oP13nColumnsPanel._updateTableItems.reset();
			oP13nColumnsPanel._createNewColumnsItem.reset();
			oP13nColumnsPanel.fireAddColumnsItem.reset();

			oItem.data('P13nColumnKey', '4712');
			oP13nColumnsPanel._getArrayIndexByItemKey.returns(1);

			oP13nColumnsPanel._handleItemVisibilityChanged(oItem);

			strictEqual(oP13nColumnsPanel.getColumnsItems.called, true, "Method shall be executed");
			strictEqual(oP13nColumnsPanel._getArrayIndexByItemKey.called, true, "Method shall be executed");
			strictEqual(oP13nColumnsPanel._updateTableItems.called, true, "Method shall be executed");
			strictEqual(oP13nColumnsPanel._createNewColumnsItem.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel.fireAddColumnsItem.called, false, "Method shall not be executed");
			strictEqual(oP13nColumnsPanel.getColumnsItems()[1].setVisible.called, true, "Method shall be executed");
		});
		
	}());
</script>


</head>
<body id="body" class="sapUiBody">
	<h1 id="qunit-header">qUnit Page for sap.m.P13nColumnsPanel</h1>
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>

	<div id="content"></div>
</body>
</html>
